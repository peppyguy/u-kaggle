{"cells":[{"metadata":{"_uuid":"b9b26559d25d8ab8e29218164d029ffbba9ed572"},"cell_type":"markdown","source":"## Summary of the Notebook\nHi, I'm ***KH Huang***, an enthusiastic data scientist from ***Taiwan***.\n\nIn this notebook, I'm going to use **t-SNE**, a dimension reduction technique, to *summarize* the economic freedom scores.  \nAs the notebook goes, we could **visualize the variance of economic freedom** within each continent."},{"metadata":{"_uuid":"53200a23e0bcbc8abb4ce200121f7a58bd7d4b7d"},"cell_type":"markdown","source":"## Load Data\nThe **economic-freedom** dataset and **country-to-continent** are used"},{"metadata":{"_uuid":"3ef10054ee63205700e30e908d4162fac6f22583","_execution_state":"idle","trusted":true},"cell_type":"code","source":"library(tidyverse)\nlibrary(ggthemes)\nlibrary(gridExtra)\nlibrary(Rtsne)\nlibrary(corrplot)\n\ndat <- read_csv(\"../input/economic-freedom/efw_cc.csv\")\ncountry_dat <- read_csv(\"../input/country-to-continent/countryContinent.csv\")\n\n","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"488c656fca40ffbad79457a3a3a87475b6b16841"},"cell_type":"markdown","source":"## Join the Two Dataset\nAdd the *continent* and *sub-region* information to the economic freedom dataset  \nAnd check if there's any country not being provided continent information"},{"metadata":{"trusted":true,"_uuid":"54ed17031dad264025a4e210be60dfcc29841c44"},"cell_type":"code","source":"dat <- left_join(dat, country_dat, by = c(\"ISO_code\" = \"code_3\")) %>%\n    select(year, ISO_code, continent, sub_region, everything())\nprint(dat[is.na(dat$sub_region), 1:5])","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"805dd75b434ad056c1c30a1dffca15659e8e3395"},"cell_type":"markdown","source":"## Add Missing Geographical Data\nWe only need to add the geographical information of Barbados, by [simple Wiki searching](https://en.wikipedia.org/wiki/Barbados)"},{"metadata":{"trusted":true,"_uuid":"60199d97fec516144b07b5561b8113e4c0935561"},"cell_type":"code","source":"dat[dat$ISO_code == \"BRD\", \"continent\"] <- \"Americas\"\ndat[dat$ISO_code == \"BRD\", \"sub_region\"] <- \"Caribbean\"\nprint(dat[is.na(dat$sub_region), 1:5])","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"d422600dc633aa4ea4fc90a7a9a8a9bb94ead990"},"cell_type":"markdown","source":"## Note the \"Summary Indices\"\nI haven't check the official documents provided by [Fraser Institue](https://www.fraserinstitute.org/studies/economic-freedom), though  \nI *guess* there exist summary indices of each \"area\" in the dataset  \nFor example, '1_size_government' is just the average of variable '1a' to '1d'   \nThus, these summary indices would be considered redundant (*just* to our dimension reduction task in this notebook) and would be removed accordingly"},{"metadata":{"trusted":true,"_uuid":"f65dd72ff4f6a7f8e5019d810b93d1d4abf474a0"},"cell_type":"code","source":"# data meaning assumption\ncbind(\n    dat %>% \n        select(starts_with(\"1_\")),\n    my_guess = rowMeans(dat %>%\n                            select(starts_with(\"1\"), -starts_with(\"1_\")), na.rm = TRUE)\n) %>% head(10)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"1eaa027d44c177c24150ba195310f3ba852cae78"},"cell_type":"markdown","source":"## Keep Variables We Need and Use Only 2016 Data\nI put a \"var_\" prefix for each of the economic freedom measurement variables, so that I could access them more easily with tidyverse's starts_with() later on  \nFor countries having NA in any one of the measurement, I arbituarily drop them  \n"},{"metadata":{"trusted":true,"_uuid":"5cb5568a23005dd81769cd4d248dfcb5172cdc07"},"cell_type":"code","source":"dat <- dat %>% \n    filter(year == 2016) %>%\n    select(countries, continent, sub_region, rank, quartile, `ECONOMIC FREEDOM`, starts_with(\"1\"), starts_with(\"2\"), starts_with(\"3\"), starts_with(\"4\"), starts_with(\"5\"),\n           -starts_with(\"1_\"), -starts_with(\"2_\"), -starts_with(\"3_\"), -starts_with(\"4_\"), -starts_with(\"5_\")) %>%\n    mutate(quartile = as.factor(quartile))","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"a22093c4a275efc54ad6cff08a5df88fbfd5921e"},"cell_type":"code","source":"colnames(dat)[-(1:6)] <- paste(\"var\", colnames(dat)[-(1:6)], sep = \"_\")\ndat <- dat %>% drop_na(starts_with(\"var_\"))\nprint(paste0(\"if data have no NAs: \", sum(colSums(is.na(dat))) == 0))","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"727f5d0af74328c70a72b8597e45ea0ba2841cb5"},"cell_type":"markdown","source":"## Correlation: Where We Start to Think Dimension Reduction Would Work\nWe could find that many variables are correlated through the correlation plot  \nAnd thus hypothesize that: maybe only few variables are enough to explain the variance within the data"},{"metadata":{"trusted":true,"_uuid":"e1bfba3fe5bf5b10e1d9c1689fd6bef51c79ab4c"},"cell_type":"code","source":"# code taken from corrplot vignette\ncol <- colorRampPalette(c(\"#BB4444\", \"#EE9988\", \"#FFFFFF\", \"#77AADD\", \"#4477AA\"))\ncorrplot(dat %>% select(starts_with(\"var_\")) %>% cor(), \n         method = \"color\", col = col(200),\n         type = \"upper\", order = \"hclust\", number.cex = 0.4,\n         addCoef.col = \"black\", # Add coefficient of correlation\n         tl.col = \"black\", tl.srt = 90, tl.cex = .5, # Text label color and rotation\n         # Combine with significance\n         p.mat = cor.mtest(dat %>% select(starts_with(\"var_\")))$p, sig.level = 0.01, insig = \"blank\", \n         # hide correlation coefficient on the principal diagonal\n         diag = FALSE)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"f9e825cf1f0f06582ff8d82f2957a423225f80e6"},"cell_type":"markdown","source":"## Dimension Reduction\nPCA and t-SNE are two of the most popular dimension reduction techniques  \nTo introduce very briefly,\n- PCA maily explain **linear **relation, taking less computing burden\n- t-SNE takes **non-linearity** into account, more computing power is needed"},{"metadata":{"trusted":true,"_uuid":"bf317eb34434bea018f2c37119e2af0ec964530b"},"cell_type":"code","source":"# prepare pca\npca <- dat %>%\n    select(starts_with(\"var_\")) %>%\n    prcomp(x = .,\n           center = TRUE,\n           scale = TRUE)\n\ndat_pca <- cbind(\n    dat,\n    (dat %>%\n         select(starts_with(\"var_\")) %>%\n         predict(pca, newdata = .))[, 1:2]\n)\n\n# prepare tsne\nset.seed(1)\ntsne <- Rtsne(X = dat %>%\n                  select(starts_with(\"var_\")) %>%\n                  as.matrix(), \n              dims = 2, perplexity=30, \n              pca = TRUE, pca_center = TRUE, pca_scale = TRUE,\n              verbose=TRUE, max_iter = 1000)\ndat_tsne <- tsne$Y\ncolnames(dat_tsne) <- c(\"tsne_d1\", \"tsne_d2\")\ndat_tsne <- cbind(\n    dat,\n    dat_tsne\n)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"cb07d3dc41d35316ca40f5fb627a034b6510f005"},"cell_type":"markdown","source":"## Sanity Check\n### Would the Distribution of Summarized Variables be consistent with the Ranking? \nUsing blue to represent more economic freedom and orange as the oppisite,  \nwe can see that in both PCA and t-SNE plot,   \ncontries in quantile 1 and 4 are located at the two ends of distribution  \nIn contrast, that countries in quantile 2 and 3 are located less distinctively at the middle of the plot\n\nAnd we can see that there are some interestingly **deviant data points** located at the **upper left** part of the **PCA plot**\n"},{"metadata":{"trusted":true,"_uuid":"48c974a64c935d0ec48c9e80b2a0ac27a21f6110"},"cell_type":"code","source":"grid.arrange(\n    dat_pca %>%\n        ggplot(mapping = aes(x = PC1, y = PC2)) +\n        geom_point(mapping = aes(colour = quartile), \n                   size = 3) + \n        scale_colour_manual(values = c(\"#2c7fb8\", \"#7fcdbb\", \"#fec44f\", \"#d95f0e\")) +\n        theme_fivethirtyeight() + \n        labs(title = \"PCA\", x = \"PCA_d1\", y = \"PCA_d2\") + \n        theme(axis.title = element_text(), plot.title = element_text(hjust = 0.5)),\n    dat_tsne %>%\n        ggplot(mapping = aes(x = tsne_d1, y = tsne_d2)) +\n        geom_point(mapping = aes(colour = quartile), \n                   size = 3) + \n        scale_colour_manual(values = c(\"#2c7fb8\", \"#7fcdbb\", \"#fec44f\", \"#d95f0e\")) +\n        theme_fivethirtyeight() +\n        labs(title = \"t-SNE\", x = \"t-SNE_d1\", y = \"t-SNE_d2\") +\n        theme(axis.title = element_text(), plot.title = element_text(hjust = 0.5)),\n    ncol = 2)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"fee6ee31b501a436b431f5dae248261ff7b3ae12"},"cell_type":"markdown","source":"## Check the Deviants in PCA Plot\nI manually select the data points existing at the extreme ends in the PCA plot  \nand also select some countries according to my personal preference  \nto see how they would be located in the t-SNE plot\n\nSo the deviants in the PCA plot include countries from different continents!  \nAnd the countries located at the corner of the PCA plot also are located at the corner of t-SNE plot  \nIn the following analysis, I'll use only **t-SNE** variables since they seem to possess **smoother distribution**"},{"metadata":{"trusted":true,"_uuid":"ec0501e9464822115a0f3f02d5ced1588728065e"},"cell_type":"code","source":"# for the deviants in PCA, where would they be positioned in t-SNE?\ndat_pca_selected <- dat_pca %>%\n    filter(\n        (PC1 <= -5 | PC2 >= 4) | \n            (PC1 >= 4 & PC2 < 0) | \n            countries %in% c(\"China\", \"America\", \"Taiwan\", \"Chile\", \"Germany\", \"Russia\", \"Iran\", \"Turkey\", \"Malaysia\", \"Peru\", \"Ukraine\", \"Jordan\"))\ndat_tsne_selected <- dat_tsne %>%\n    filter(countries %in% unique(dat_pca_selected$countries))\ngrid.arrange(\n    dat_pca %>%\n        ggplot(mapping = aes(x = PC1, y = PC2)) +\n        geom_point(mapping = aes(colour = quartile), \n                   size = 3) + \n        geom_point(size = 3.5, shape = 1, data = dat_pca_selected) +\n        ggrepel::geom_label_repel(mapping = aes(label = countries), data = dat_pca_selected) +\n        scale_colour_manual(values = c(\"#2c7fb8\", \"#7fcdbb\", \"#fec44f\", \"#d95f0e\")) +\n        theme_fivethirtyeight() + \n        labs(title = \"PCA\", x = \"PCA_d1\", y = \"PCA_d2\") + \n        theme(axis.title = element_text(), plot.title = element_text(hjust = 0.5)),\n    dat_tsne %>%\n        ggplot(mapping = aes(x = tsne_d1, y = tsne_d2)) +\n        geom_point(mapping = aes(colour = quartile), \n                   size = 3) + \n        geom_point(size = 3.5, shape = 1, data = dat_tsne_selected) +\n        ggrepel::geom_label_repel(mapping = aes(label = countries), data = dat_tsne_selected) +\n        scale_colour_manual(values = c(\"#2c7fb8\", \"#7fcdbb\", \"#fec44f\", \"#d95f0e\")) +\n        theme_fivethirtyeight() +\n        labs(title = \"t-SNE\", x = \"t-SNE_d1\", y = \"t-SNE_d2\") +\n        theme(axis.title = element_text(), plot.title = element_text(hjust = 0.5)),\n    ncol = 2)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"fdbda35704162f372a8c4e3b8e6499f2c38b9216"},"cell_type":"markdown","source":"## Which Continent Has More Variance in Economic Freedom?\nAfrica generally includes countries having less economic freedom  \nwhile Europe has most countries with better economic freedom  \n\nThe countries in **Asia and Americas** seem to be **more diversified** regarding economic freedom\n"},{"metadata":{"trusted":true,"_uuid":"5fd8630f33a50cd72d4a1a0dd36f4eeedcb3b8c9"},"cell_type":"code","source":"dat_tsne %>%\n    ggplot(mapping = aes(x = tsne_d1, y = tsne_d2)) +\n    geom_point(mapping = aes(colour = quartile), \n               size = 3) + \n    scale_colour_manual(values = c(\"#2c7fb8\", \"#7fcdbb\", \"#fec44f\", \"#d95f0e\")) +\n    theme_fivethirtyeight() +\n    facet_wrap(~continent) +\n    labs(title = \"t-SNE\", x = \"t-SNE_d1\", y = \"t-SNE_d2\") +\n    theme(plot.title = element_text(hjust = 0.5))","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"f09ec6f192d386e37705b8e4e518175186d2722b"},"cell_type":"markdown","source":"## May Sub-Region be the Reason for Variance within Continent?\nWithin Americas, South America has more economic freedom diversity  \nWithin Asia, Western Asia has more economic freedom diversity"},{"metadata":{"trusted":true,"_uuid":"66f0e407b749970b7e236bccedf0f8b67b6df108"},"cell_type":"code","source":"for (cnt in unique(dat$continent)) {\n    p <- dat_tsne %>% filter(continent == cnt) %>%\n        ggplot(mapping = aes(x = tsne_d1, y = tsne_d2)) +\n        geom_point(mapping = aes(colour = quartile), \n                   size = 3) + \n        scale_x_continuous(limits = range(dat_tsne$tsne_d1)) + \n        scale_y_continuous(limits = range(dat_tsne$tsne_d2)) + \n        scale_colour_manual(values = c(\"1\" = \"#2c7fb8\", \"2\" = \"#7fcdbb\", \"3\" = \"#fec44f\", \"4\" = \"#d95f0e\")) +\n        theme_fivethirtyeight() +\n        facet_wrap(~sub_region) +\n        labs(title = paste(\"t-SNE:\", cnt), x = \"t-SNE_d1\", y = \"t-SNE_d2\") + \n        theme(axis.title = element_text(), plot.title = element_text(hjust = 0.5))\n    print(p)\n}","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"4f66c0c292dc3c4fae0194f17fc5470c3684cbe2"},"cell_type":"markdown","source":"## Conclusion\nWhen conducting analysis, the geography information (continent or sub-region) would be strong confounding factor  \nFor example, the general evolution trend of economic freedom would vary greatly among sub-region within Americas or Asia  \n\nI'll keep refining this notebook  \nPlease comment if you find any way I could improve the analysis\nThanks for your reading!"}],"metadata":{"kernelspec":{"display_name":"R","language":"R","name":"ir"},"language_info":{"mimetype":"text/x-r-source","name":"R","pygments_lexer":"r","version":"3.4.2","file_extension":".r","codemirror_mode":"r"}},"nbformat":4,"nbformat_minor":1}