{"cells":[{"metadata":{"_uuid":"42114aed978c2d352558ee6fd1dc5d0c93c15250"},"cell_type":"markdown","source":"## Introduction\n\nAs a fan of South Park, the animated sitcom featuring dark humor and social satire, I was curious how men and women view the show differently. For example, many people think toilet humor appeals more to men than women, but is that supported by episode ratings broken down by gender? I scraped the basic information (season, episode, plot) and ratings (overall, male, female) of every South Park episode up to Season 21 from imdb.com, and performed various data analysis to explore the gender difference in episode ratings."},{"metadata":{"_uuid":"c09c041843716d0ef88fcc42bf5a812967c05cc4"},"cell_type":"markdown","source":"## Reading in and exploring the data"},{"metadata":{"_uuid":"8f2839f25d086af736a60e9eeb907d3b93b6e0e5","_cell_guid":"b1076dfc-b9ad-4769-8c92-a6c4dae69d19","trusted":true,"_kg_hide-output":true},"cell_type":"code","source":"# read in the libraries we're going to use\nlibrary(tidyverse) # general utility & workflow functions\nlibrary(tidytext) # tidy implimentation of NLP methods\nlibrary(topicmodels) # for LDA topic modelling \nlibrary(tm) # general text mining functions\nlibrary(SnowballC) # for stemming\nlibrary(reshape2) \n\n# read in our data\nsp <- read_csv(\"../input/SouthPark.csv\")\nsummary(sp)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"ba93ddd847bd978ad3eb1312869ffdb333a2ee94"},"cell_type":"markdown","source":"First, let's look at the distributions of male ratings, female ratings, and rating differences of all the episodes."},{"metadata":{"_cell_guid":"79c7e3d0-c299-4dcb-8224-4455121ee9b0","_uuid":"d629ff2d2480ee46fbb7e2d37f6b5fab8052498a","trusted":true},"cell_type":"code","source":"par(mfrow=c(3,1))\nhist(sp$Male_rating, col='dodgerblue3', breaks=seq(6,10,0.3), main='Distribution of Male Ratings', xlab='Rating')\nhist(sp$Female_rating, col='hotpink3', breaks=seq(5,9.5,0.3), main='Distribution of Female Ratings', xlab='Rating')\nhist(sp$Diff, col='seagreen3', breaks=seq(-1,2,0.2), main='Distribution of Rating Differences (Male - Female)', xlab='Rating Difference')","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"6fae5646103f579c93f8dda6130520eda303f639"},"cell_type":"markdown","source":"Both male and female rating distributions have a longer left tail, but the skewness is even heavier for female ratings, which means women are more likely to give very low scores than very high scores. The distribution of gender difference in rating is right-skewed. Most episodes have similar male and female ratings; some episodes are rated much more positively by men, but few episodes are rated much more positively by women. \n\nNext, **how well are male and female ratings correlated?**"},{"metadata":{"trusted":true,"_uuid":"cd985e7bfa8e4117fbb97cfeda390d750250611b"},"cell_type":"code","source":"cor(sp$Male_rating, sp$Female_rating, method='pearson')","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"6c9efd4e629383d3b653063cd5db9f1d23212deb"},"cell_type":"code","source":"ggplot(sp, aes(x=Male_rating, y=Female_rating)) +\n    geom_point(aes(color=Season))","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"07f08cccc6e88161ba499f66b3e50df74384e2c9"},"cell_type":"markdown","source":"There's a high positive correlation between male and female ratings, but among episodes with low ratings, the correlation is weaker. \n\n**Which episodes have the highest ratings by each gender?**"},{"metadata":{"trusted":true,"_uuid":"9d851a4888f504b176f7beb305deaa3518877e0b"},"cell_type":"code","source":"sp_sorted_male <- sp[order(sp$Male_rating),]\nsp_sorted_female <- sp[order(sp$Female_rating),]\n\n# 10 best episodes according to male and female ratings \ntop10_m <- tail(sp_sorted_male[,1:7],10) \ntop10_f <- tail(sp_sorted_female[,1:7],10)\ntop10_m \ntop10_f\n\nprint('Episodes in both top 10 lists:')\nintersect(top10_m$Title, top10_f$Title)\n\nprint('Episodes only in male top 10:')\nsetdiff(top10_m$Title, top10_f$Title)\n\nprint('Episodes only in female top 10:')\nsetdiff(top10_f$Title, top10_m$Title)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"feeb53424a7433a3b0473676462d738a7bf3bc8a"},"cell_type":"markdown","source":"7 episodes appear in the top 10 by both male and female ratings, which shows men and women largely agree on the best episodes. However, it's interesting to note that the female top 10 episodes all have similar male and female ratings, whereas two episodes in the male top 10 have relatively large gender difference in rating: Men rated \"Good Times with Weapons\" 0.9 point higher than women, and \"Make Love, Not Warcraft\" 0.7 point higher than women. Neither of these episode are in the female top 10 list, and nor is \"Woodland Critter Christmas\". On the other hand, \"Tsst\", \"Breast Cancer Show Ever\", and \"You Have 0 Friends\" are only in the female top 10 list. These differences may be due to the fact that some themes (e.g. video games, fighting) are more appealing to men, and some (e.g. social media, emphasis on female characters) more appealing to women. "},{"metadata":{"_uuid":"9fe4d7c864b241cb867ef83c1d993611529824fe"},"cell_type":"markdown","source":"**Which episodes have the lowest ratings by each gender?**"},{"metadata":{"trusted":true,"_uuid":"fea3a871a94942851411c6c5e8aeaeb44f71401f"},"cell_type":"code","source":"# 10 worst episodes according to male and female ratings \nbottom10_m <- head(sp_sorted_male[,1:7],10) \nbottom10_f <- head(sp_sorted_female[,1:7],10)\nbottom10_m \nbottom10_f\n\nprint('Episodes in both bottom 10 lists:')\nintersect(bottom10_m$Title, bottom10_f$Title)\n\nprint('Episodes only in male bottom 10:')\nsetdiff(bottom10_m$Title, bottom10_f$Title)\n\nprint('Episodes only in female bottom 10:')\nsetdiff(bottom10_f$Title, bottom10_m$Title)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"4e86542dc1e92d6fe858802d035da12ecefb00d5"},"cell_type":"markdown","source":"Apparently, men and women agree less when it comes to the worst episodes. Only four episodes are in both male and female bottom 10 lists: 'A Million Little Fibers', 'Going Native', 'White People Renovating Houses', 'I Should Have Never Gone Ziplining'."},{"metadata":{"_uuid":"548364f9973a8fe6d42b270e2f94096378058899"},"cell_type":"markdown","source":"**Which episodes have the largest gender differences in rating?**"},{"metadata":{"trusted":true,"_uuid":"94c57572d5e687e5b26600854d057a4d2a8ba3d7"},"cell_type":"code","source":"# sort the dataframe by the \"Diff\" column\nsp_sorted <- sp[order(sp$Diff),]\n\n# look at the highest and lowest difference values\nprint('Most negative difference values (indicating strongest female preference):')\nhead(sp_sorted$Diff,20)\n\nprint('Most positive difference values (indicating strongest male preference):')\ntail(sp_sorted$Diff,20)","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"85bcd4c7f6391bbf57dfa0c371d501dc48120534"},"cell_type":"code","source":"# because there are a lot of ties, we arbitrarily choose the cut-off point as -0.6 and 1.2 for female and male preference respectively\ntop_female_pref <- sp_sorted %>%\n                filter(Diff <= -0.6) %>%\n                select(c(Title,Male_rating,Female_rating,Diff))\n\ntop_male_pref <- sp_sorted %>%\n                filter(Diff >= 1.2) %>%\n                select(c(Title,Male_rating,Female_rating,Diff))\n\n# convert to long format\nfemale_pref_long <- melt(top_female_pref[,c('Title','Male_rating','Female_rating')], id.var='Title')\nmale_pref_long <- melt(top_male_pref[,c('Title','Male_rating','Female_rating')], id.var='Title')","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"6ca5f7079098c445f6de81b82bf23fa1e5b0b772"},"cell_type":"code","source":"# create grouped bar plots\npar(mfrow=c(2,1))\n\nggplot(male_pref_long, aes(x = Title, y = value, fill = variable)) + \n  geom_bar(stat = \"identity\", width=0.8, position = position_dodge(width=0.6)) +\n  scale_fill_manual(values=c('dodgerblue2','hotpink2')) +\n  scale_y_continuous(breaks=seq(5,8,1)) +\n  theme(axis.text.x = element_text(face='bold', angle=75)) +\n  labs(title='10 Episodes with Strongest Male Preference', x='', y='Rating')\n\nggplot(female_pref_long, aes(x = Title, y = value, fill = variable)) + \n  geom_bar(stat = \"identity\", width=0.8, position = position_dodge(width=0.6)) +\n  scale_fill_manual(values=c('dodgerblue2','hotpink2')) +\n  scale_y_continuous(breaks=seq(5,8,1)) +                   \n  theme(axis.text.x = element_text(face='bold', angle=75)) +\n  labs(title='8 Episodes with Strongest Female Preference', x='', y='Rating')","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"9d21d3631e6a31f98dff9f5a332911762887099e"},"cell_type":"markdown","source":"It seems that episodes with strongest male preference tend to be from the later seasons (20-21), whereas episodes with strongest female preference don't have very clear patterns, except that two of them are related to celebrities.\n\nNext, I'll use unsupervised topic modeling with LDA to explore the most common themes in male-preference and female-preference episodes. This time all episodes with |male rating - female rating| >= 0.5 will be included in the analysis."},{"metadata":{"_uuid":"f9a1e978b8ab6f5dabb31a3ddc5eefd8f458cae7"},"cell_type":"markdown","source":"## Pre-processing text"},{"metadata":{"trusted":true,"_uuid":"5e24bbdf3654bc7ef8402ff97e48425c28b44035"},"cell_type":"code","source":"clean_text <- function(text)\n{    \n    # remove some common words in South Park\n    words_to_remove <- c('South','Park','Cartman','Kyle','Stan','Butters','Kenny', 'Randy','[Pp]eople','[Ss]chool','[Bb]oys', '[Kk]ids', \n                         '\\\\btalk', '\\\\btell', '\\\\bwalk', '\\\\bstart', '\\\\bbegin', '\\\\bepisode', '[Tt]own')\n    \n    # create a document term matrix to clean\n    plotCorpus <- Corpus(VectorSource(text))\n    plotCorpus <- tm_map(plotCorpus, removeWords, words_to_remove) \n    plotDTM <- DocumentTermMatrix(plotCorpus)\n\n    # convert the document term matrix to a tidytext corpus\n    plotDTM_tidy <- tidy(plotDTM)\n\n    # remove stopwords\n    plotDTM_cleaned <- plotDTM_tidy %>%\n        anti_join(stop_words, by = c(\"term\" = \"word\")) %>%  # remove English stopwords\n        mutate(stem = wordStem(term)) # stemming the words\n\n    # reconstruct cleaned documents \n    cleaned_documents <- plotDTM_cleaned %>%\n        group_by(document) %>% \n        mutate(terms = toString(rep(stem, count))) %>%\n        select(document, terms) %>%\n        unique()\n    \n    return(cleaned_documents)\n}","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"dd5286ba0ca433c50c86d54a124673aea334dd8a"},"cell_type":"code","source":"male_pref <- sp %>%\n            filter(Diff >= 0.5) \nplots_m <- clean_text(male_pref$Plot)\n\nfemale_pref <- sp %>%\n            filter(Diff <= -0.5) \nplots_f <- clean_text(female_pref$Plot)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"e552c553b83c19c8e34824923dc901f3b36b48ba"},"cell_type":"markdown","source":"## Unsupervised topic modeling "},{"metadata":{"_uuid":"c87c25ca941ebcbccf58e3f14342514a07700f74"},"cell_type":"markdown","source":"Are there any common themes among the episodes with higher male ratings or higher female ratings? I will use LDA to extract a number of topics in the episode plots."},{"metadata":{"trusted":true,"_uuid":"4d7362213f4af5899a1c48a285f27f99434d027d"},"cell_type":"code","source":"# function to get & plot the most informative terms by a specificed number of topics\ntop_terms_by_topic <- function(input_text, # should be a columm from a dataframe\n                                   plot = T, # return a plot? TRUE by defult\n                                   number_of_topics = 3) # number of topics (3 by default)\n{    \n    # create a corpus (type of object expected by tm) and document term matrix\n    Corpus <- Corpus(VectorSource(input_text)) # make a corpus object\n    DTM <- DocumentTermMatrix(Corpus) # get the count of words/document\n\n    # remove any empty rows in our document term matrix (if there are any \n    # we'll get an error when we try to run our LDA)\n    unique_indexes <- unique(DTM$i) # get the index of each unique value\n    DTM <- DTM[unique_indexes,] # get a subset of only those indexes\n    \n    # preform LDA & get the words/topic in a tidy text format\n    lda <- LDA(DTM, k = number_of_topics, control = list(seed = 1234))\n    topics <- tidy(lda, matrix = \"beta\") # convert the LDA output to a tidy\n\n    # get the top ten terms for each topic\n    top_terms <- topics  %>% # take the topics data frame and..\n      group_by(topic) %>% # treat each topic as a different group\n      top_n(10, beta) %>% # get the top 10 most informative words\n      ungroup() %>% # ungroup\n      arrange(topic, -beta) # arrange words in descending informativeness\n    \n     # if the user asks for a plot (TRUE by default)\n    if(plot == T){\n        # plot the top ten terms for each topic in order\n        top_terms %>% # take the top terms\n          mutate(term = reorder(term, beta)) %>% # sort terms by beta value \n          ggplot(aes(term, beta, fill = factor(topic))) + # plot beta by theme\n          geom_col(show.legend = FALSE) + # as a bar plot\n          facet_wrap(~ topic, scales = \"free\") + # which each topic in a seperate plot\n          labs(x = NULL, y = \"Beta\") + # no x label, change y label \n          coord_flip() # turn bars sideways\n    }else{ \n        # if the user does not request a plot\n        # return a list of sorted terms instead\n        return(top_terms)\n    }\n}\n","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"f687bb1f10642da0196b950ab7239781ea2d063c"},"cell_type":"code","source":"print('Top terms in episodes with stronger male preference:')\ntop_terms_by_topic(plots_m$terms)","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"d7f23f870a1535cee612a60c49a3f54f7f0d1374"},"cell_type":"code","source":"print('Top terms in episodes with stronger female preference:')\ntop_terms_by_topic(plots_f$terms)","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"4bf14c7a3ccfe0f842e15f90ac380714969c3b1a"},"cell_type":"code","source":"# try again with four topics\nprint('Top terms in episodes with stronger male preference:')\ntop_terms_by_topic(plots_m$terms, number_of_topics=4)","execution_count":null,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"be87cbc9cf2edf30f565e2155390588bac85db4a"},"cell_type":"code","source":"print('Top terms in episodes with stronger female preference:')\ntop_terms_by_topic(plots_f$terms, number_of_topics=4)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"ca6d8fdbb766ded6b4c436d8840c39cb0c9750ef"},"cell_type":"markdown","source":"The patterns are still not very clear, but we can see that episodes with stronger male preference tend to feature Mr. Garrison, Gerald, Heidi, Tweek, and Craig, who all have more appearance in season 20-21. In contrast, women seem to prefer episodes featuring Wendy, celebrities, and pop culture (e.g. memes, Goth). \n\nOf course, whether men or women like an episode better isn't just determined by the words in the plot. There are many other factors, like the style of humor, the way of storytelling, character development, etc. This project is just my first step to explore South Park with data science and an opportunity to practice topic modeling."}],"metadata":{"kernelspec":{"display_name":"R","language":"R","name":"ir"},"language_info":{"mimetype":"text/x-r-source","name":"R","pygments_lexer":"r","version":"3.4.2","file_extension":".r","codemirror_mode":"r"}},"nbformat":4,"nbformat_minor":1}