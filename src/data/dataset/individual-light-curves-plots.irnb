{"cells":[{"metadata":{"_uuid":"9b227b5178614f7d3dbd8a13ff4f8f43cc19112d"},"cell_type":"markdown","source":"Hello everyone\n\nThis is my first Kernel ever so please just take it as a first trial.\n\nHere you'll see a piece of code that will allow you to plot some light fluxes for some classes of interest or objects in particular belonging to the training data, as they are intended to be studied by target."},{"metadata":{"_uuid":"51276f513024070a27607f80aaa39fa1428b58af"},"cell_type":"markdown","source":"**Loading of data and libraries**"},{"metadata":{"_uuid":"5a1fccfffdc01033d1e61b2de13999f0fab5abb8","_execution_state":"idle","trusted":true},"cell_type":"code","source":"## Importing packages and loading libraries\nrm(list=ls())\nlibrary('ggplot2')\nlibrary('data.table')\nlibrary('NbClust')\ntraining.metadata <- fread(\"../input/training_set_metadata.csv\")\ntrain <- fread(\"../input/training_set.csv\")\n","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"af641db1734daf4dc5c6f55aed1e38e6a0325da1"},"cell_type":"markdown","source":"**Data class transformations, mainly integers to factors.**"},{"metadata":{"trusted":true,"_uuid":"26892e0d0f48b3258258fe8ef3552b55e107beb7"},"cell_type":"code","source":"train$object_id<-factor(train$object_id)\ntrain$passband<-ordered(train$passband)\ntrain$detected<-factor(train$detected)\n\ntraining.metadata$object_id<-factor(training.metadata$object_id)\ntraining.metadata$ddf<-factor(training.metadata$ddf)\ntraining.metadata$target<-factor(training.metadata$target)\nlevels(training.metadata$target)<-c(levels(training.metadata$target),'99')","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"97f1f0d5f393e9f50b3f8b7aa6f09dd5829e7f4b"},"cell_type":"markdown","source":"While trying to plot the light curves it became obvious that the observations had been taken in different time intervals, and joining such distant data points with lines didn't make much sense.\n**This is a (rather clumsy) way of grouping these different time intervals.**\nNew variable called *cycle*."},{"metadata":{"trusted":true,"_uuid":"f57f048b1924fe3d85fb960bde15778dd233d98c"},"cell_type":"code","source":"cycles<-aggregate(train$mjd, by=list(train$object_id), function(x) NbClust(x, min.nc = 2, max.nc = 6, \n          method = \"single\", index =\"kl\")$Best.partition)\ntrain$cycle<-as.integer(as.character(unlist(lapply(cycles$x, function(x) factor(x,levels = unique(x), labels= sort(unique(x)))))))\nrm(cycles)\ntrain[c(121:124,230:233),]","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"08ac19fedd5def2a496ffd814135ae50a43a3238"},"cell_type":"markdown","source":"**First customizable plot: plots the light curves of a defined number of random objects belonging to a defined class (target).**"},{"metadata":{"trusted":true,"_uuid":"b784b57089fe739d95a6f9e673aa51b7ca1915b8"},"cell_type":"code","source":"Class<-92\nSample<-2\n\nrows<-which(training.metadata$target==Class)\noptions(repr.plot.width = 10, repr.plot.height = 5)\nfor(i in sample(rows,Sample)){\n  lines<-ggplot(train[which(train$object_id==training.metadata$object_id[i]),], aes(x = mjd, y = flux, color = passband)) +\n  geom_line(aes(group = interaction(passband, cycle))) +\n  geom_point() +\n  theme_minimal() +\n  scale_colour_manual(values = c( \"0\" = \"#00a7ba\", \"1\" = \"#06065b\", \"2\" = \"#282cff\", \"3\" = \"#a100ff\", \"4\" = \"#ff5bc5\", \"5\" = \"#ff0000\"))+\n  guides(fill=guide_legend(title=\"\")) +\n  ggtitle(paste(\"Object \",training.metadata$object_id[i],', class ', training.metadata$target[i],sep='')) +\n  theme(plot.title = element_text(hjust = 0.5)) \n  \n  gridExtra::grid.arrange(lines, ncol=1)\n}\nrm(i,rows,Class,Sample)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"431884f95002ad911601845a0da2893af571b2d2"},"cell_type":"markdown","source":"Comment: without the new class *cycle* the different (usually 3) time intervals would have been linked by the same lines, which I think would be deceiveing."},{"metadata":{"_uuid":"2f9f4e02246040418f8a0442b002b276580a4649"},"cell_type":"markdown","source":"**Second customizable plot: plots the light curve of a certain object**"},{"metadata":{"trusted":true,"_uuid":"81a824ccf91b942a6378ccb096a9c09bda4331e3"},"cell_type":"code","source":"Object<-615\n\nrows<-which(training.metadata$object_id==Object)\noptions(repr.plot.width = 10, repr.plot.height = 5)\nggplot(train[which(train$object_id==training.metadata$object_id[rows]),], aes(x = mjd, y = flux, color = passband)) +\ngeom_line(aes(group = interaction(passband, cycle))) +\ngeom_point() +\ntheme_minimal() +\nscale_colour_manual(values = c( \"0\" = \"#00a7ba\", \"1\" = \"#06065b\", \"2\" = \"#282cff\", \"3\" = \"#a100ff\", \"4\" = \"#ff5bc5\", \"5\" = \"#ff0000\"))+\nguides(fill=guide_legend(title=\"\")) +\nggtitle(paste(\"Object \",training.metadata$object_id[rows],', class ', training.metadata$target[rows],sep='')) +\ntheme(plot.title = element_text(hjust = 0.5)) \n \nrm(rows,Object)","execution_count":null,"outputs":[]}],"metadata":{"kernelspec":{"display_name":"R","language":"R","name":"ir"},"language_info":{"mimetype":"text/x-r-source","name":"R","pygments_lexer":"r","version":"3.4.2","file_extension":".r","codemirror_mode":"r"}},"nbformat":4,"nbformat_minor":1}