{"cells":[{"metadata":{"_uuid":"89ab2fd182a7697020b9bc00d194ce4aa2ab82cf","_cell_guid":"da31b050-1c7f-4876-86e1-89eea8a41f1f"},"cell_type":"markdown","source":"**About the Analysis:**\n\nThis Analysis is on a topic which is very important to me(i am sure for everybody else too), yes it's about FOOD, the basic requirement for any organism to survive. People like me, are very privileged to have the luxury to choose the Food they want to have any given day, but in this small world, there still exists a lot of places where people struggle to get one meal per day. Hunger and Malnutrition is the number one health risk in today's world because 1 in every 9 people, do not get proper nutrition to lead a healthy life.\n\n*\"The world needs to produce at least 50% more food to feed 9 billion people by 2050. But climate change could cut crop yields by more than 25%. The land, biodiversity, oceans, forests, and other forms of natural capital are being depleted at unprecedented rates. Unless we change how we grow our food and manage our natural capital, food security—especially for the world’s poorest—will be at risk.\"  *(World Bank, 2016)"},{"metadata":{"_uuid":"f170de162401ff9ec9a140f6f92505c80cfdd29f","_cell_guid":"b2884e6f-7441-4312-b456-4c6fb7c43aa3"},"cell_type":"markdown","source":"**About the data:**\n\nThe Food and Agriculture Organization(FAO) of the United Nations database has one dataset 'Food Balance Sheets'. It presents a comprehensive picture of the pattern of a country's food supply during a specified reference period(1961-2013). The food balance sheet shows for each food item the sources of supply and its utilization. This dataset is focused on two utilizations of each food item available:\n\nFood - refers to the total amount of the food item available as human food during the reference period.\n\nFeed - refers to the quantity of the food item available for feeding to the livestock and poultry during the reference period."},{"metadata":{"_uuid":"6ae5c8ed33691ae1c480849fe1054475629cf1d2","_cell_guid":"34a019ca-a585-45b5-b830-43f724a88582"},"cell_type":"markdown","source":"In order to do the analysis, lets **Load the Libraries** and **Read the dataset**"},{"metadata":{"_kg_hide-output":true,"_kg_hide-input":true,"_uuid":"d2158b8adcc2330ed04994415af79655e14722b4","_cell_guid":"1d6ecf9a-74cf-4b81-a01c-381fd899402d","trusted":true},"cell_type":"code","source":"library(\"readr\") # data input\nlibrary('tidyr') # data wrangling\nlibrary('dplyr') # data manipulation\nlibrary('ggplot2') # visualization\nlibrary('ggthemes') # visualization\nlibrary('corrplot') # visualization\nlibrary('lubridate') # date and time\nlibrary('purrr') # data manipulation\nlibrary('cowplot')# visualization\nlibrary('maps')# visualization\nlibrary('viridis')# visualization\nlibrary('treemap')\nlibrary('leaflet')\nlibrary('dygraphs')\nlibrary('graphics')\nlibrary('forecast')\nlibrary('xts')\nlibrary('IRdisplay')\noptions(scipen = 999)\noptions(warn = -1)","execution_count":1,"outputs":[]},{"metadata":{"_uuid":"4b5575d2cc775157c5ccacef4f0c7e70736729ae","_cell_guid":"dae63204-83ba-4b81-9462-b40beb3bf254"},"cell_type":"markdown","source":"**Reading the files:**"},{"metadata":{"_kg_hide-output":true,"_uuid":"0bcdfa9b94d0dede6957b5f461e2ff2d150de48a","_cell_guid":"b06e070f-e56d-48fa-9aab-df5dbcc5c476","trusted":true},"cell_type":"code","source":"fao <-read_csv('../input/FAO.csv')","execution_count":2,"outputs":[]},{"metadata":{"_uuid":"917fb9767bcf520d4691bc6691ff4ba2b5add312","_cell_guid":"440166af-297c-422e-b9b5-3401704fa691"},"cell_type":"markdown","source":"**Checking out the data:**\n\nThe dataset has 21477 observations and 63 variables, where we have details of Food and Feed production by country  from 1961 to 2013, including geocoding of Countries. The Element code describes the code given to Food(5142) and Feed(5521) and all the measurements are in 1000 tonnes. We have different Food and Feed items and their codes such as wheat & products, barley & products, maize & products, bananas, grapes and so on."},{"metadata":{"_kg_hide-output":true,"_kg_hide-input":false,"_uuid":"b3272aefe4e640c2adda615049c6f3861de1ef36","_cell_guid":"4c88ab3a-b6df-486a-aadd-bafdf33ba592","trusted":true},"cell_type":"code","source":"summary(fao)","execution_count":3,"outputs":[]},{"metadata":{"_kg_hide-output":true,"_uuid":"1a6c34aefe88820bd69fb1b372609665436a52a8","_cell_guid":"2271dc05-2023-4b84-a5e9-b282108a196e","trusted":true},"cell_type":"code","source":"str(fao)","execution_count":4,"outputs":[]},{"metadata":{"_uuid":"2bf8104672bf951c6739feb784620d173d72597a","_cell_guid":"5fe9db9c-6034-4044-835b-8f87f4109a0b"},"cell_type":"markdown","source":"**Looking for Missing/NA values : **\n\nThere are missing values in the data pertaining to the newly formed countries such as South Sudan and countries that are formed post 1990(dissolution of the USSR and Yugoslavia in the early 1990s lead to the creation of most of the newly independent states, source:[ https://www.thoughtco.com/new-countries-of-the-world-1433444](http://)) , which do not have food and feed production details dating back to 1961. Hence, details of those countries are missing only upto 1990."},{"metadata":{"_kg_hide-input":true,"_uuid":"16efc219eb11f23be5eda241e0c7ab3ae1107d04","_cell_guid":"5c0d5834-d38d-4015-b723-8c17ffd9ec3a","trusted":true},"cell_type":"code","source":"options(repr.plot.width=6, repr.plot.height=6)\nmissing_data <- fao %>% summarise_all(funs(sum(is.na(.))/n()))\nmissing_data <- gather(missing_data, key = \"variables\", value = \"percent_missing\") \nggplot(missing_data, aes(x = reorder(variables, percent_missing), y = percent_missing)) +xlab('variables')+\n  geom_bar(stat = \"identity\", fill = \"red\", aes(color = I('white')), size = 0.3)+coord_flip()+ theme_bw()","execution_count":5,"outputs":[]},{"metadata":{"_uuid":"a197346fc2f78ed3bda18ddbbe338a231386fabf","_cell_guid":"b653efd3-dbb2-4fd5-8e0f-05966714d95f"},"cell_type":"markdown","source":"Renaming few columns for better readability and use"},{"metadata":{"_uuid":"15e8b5af191f2a701169950e95ff13b570f68bfd","_cell_guid":"cf22d352-0c01-4600-a1db-b911e4589cb0","trusted":true},"cell_type":"code","source":"colnames(fao)[1] <- \"area_abb\"\ncolnames(fao)[2] <- \"area_code\"\ncolnames(fao)[3] <- \"area\"\ncolnames(fao)[4] <- \"item_code\"\ncolnames(fao)[5] <- \"item\"\ncolnames(fao)[6] <- \"element_code\"\ncolnames(fao)[7] <- \"element\"","execution_count":6,"outputs":[]},{"metadata":{"_uuid":"85a9f6ad40c25767e2dd55d825a64003458f33fd","_cell_guid":"a3ba3934-334a-4083-8b8c-7983440570be","trusted":true},"cell_type":"code","source":"head(fao)","execution_count":7,"outputs":[]},{"metadata":{"_uuid":"53035bc11e990ec8661d0bbedaf2e08b2dc1739d","_cell_guid":"7187a4ea-b34e-44ad-9492-29f9c9cf872d"},"cell_type":"markdown","source":"**Biggest producers of FOOD in the world:**\n\nChina, India and USA are the top three producers of food in the world since 1961."},{"metadata":{"_kg_hide-input":true,"_uuid":"e1f370823e3c8a9068a25698efaf42d8210c77ea","_cell_guid":"4c142c03-1d6a-48a4-a5fa-f8b420af76a2","trusted":true},"cell_type":"code","source":"options(repr.plot.width=10, repr.plot.height=4)\nfao <- mutate(fao, Total=apply(fao[11:63], 1, sum, na.rm = T))\nfao <- mutate(fao, last5=apply(fao[58:63], 1, sum, na.rm = T))\np2 <- fao %>% group_by(area_abb, element) %>%filter(element == 'Food')%>% \nsummarise(TFO = sum(Total)) %>% ungroup()%>%mutate(pct = prop.table(TFO)*100)%>%\n    top_n(10, wt = pct)%>%\n    ggplot(aes(x = reorder(area_abb, -pct), y = pct)) + \n   geom_bar(stat = 'identity', fill = \"lightblue\", aes(color = I('black')), size = 0.1) + \n    geom_text(aes(label = sprintf(\"%.2f%%\", pct)), hjust = 0.5,\n            vjust = -0.5, size = 3)+ theme_bw()+ xlab(\"Country\") + ylab(\"Food production since 1961\")\n\np3 <- fao %>% group_by(area_abb, element) %>%filter(element == 'Food')%>% \nsummarise(TFO = sum(last5)) %>% ungroup()%>%mutate(pct = prop.table(TFO)*100)%>%\n    top_n(10, wt = pct)%>%\n    ggplot(aes(x = reorder(area_abb, -pct), y = pct)) + \n   geom_bar(stat = 'identity', fill = \"lightblue\", aes(color = I('black')), size = 0.1) + \n    geom_text(aes(label = sprintf(\"%.2f%%\", pct)), hjust = 0.5,\n            vjust = -0.5, size =3)+ theme_bw()+ xlab(\"Country\") + ylab(\"Food production since 2008-13\")\n\nplot_grid(p2,p3, align = \"h\")","execution_count":8,"outputs":[]},{"metadata":{"_uuid":"4b38cab3793983d2ec3f4db362abaaebea87d386","_cell_guid":"3abb53c0-0e2e-44b6-8c73-55cbec3393e7"},"cell_type":"markdown","source":"**Biggest producers of FEED:**\n\nChina, USA and Brazil are the largest feed producers in the world since 1961. Even in the last five years of this dataset(which is 2008-13), the biggest producers of feed are China, USA and Brazil. Russia and India also feature in the feed production list in 4th and 5th places in the last five years."},{"metadata":{"_kg_hide-input":true,"_uuid":"e7248be8e2eac5c6bb83842d448f75698d131154","_cell_guid":"ce63e3ce-174e-4682-9c70-f178291688f7","trusted":true},"cell_type":"code","source":"p4 <- fao %>% group_by(area_abb, element) %>%filter(element == 'Feed')%>% \nsummarise(TFE = sum(Total)) %>% ungroup()%>%mutate(pct = prop.table(TFE)*100)%>%\n    top_n(10, wt = pct)%>%\n    ggplot(aes(x = reorder(area_abb, -pct), y = pct)) + \n   geom_bar(stat = 'identity', fill = \"lightgreen\", aes(color = I('black')), size = 0.1) + \n    geom_text(aes(label = sprintf(\"%.2f%%\", pct)), \n            vjust = -.5, size = 3)+ theme_bw()+ xlab(\"Country\") + ylab(\"Feed production since 1961\")\n\np5 <- fao %>% group_by(area_abb, element) %>%filter(element == 'Feed')%>% \nsummarise(TFE = sum(last5)) %>% ungroup()%>%mutate(pct = prop.table(TFE)*100)%>%\n    top_n(10, wt = pct)%>%\n    ggplot(aes(x = reorder(area_abb, -pct), y = pct)) + \n   geom_bar(stat = 'identity', fill = \"lightgreen\", aes(color = I('black')), size = 0.1) + \n    geom_text(aes(label = sprintf(\"%.2f%%\", pct)), \n            vjust = -.5, size = 3)+ theme_bw()+ xlab(\"Country\") + ylab(\"Feed production since 2008-13\")\nplot_grid(p4,p5, align = \"h\")","execution_count":9,"outputs":[]},{"metadata":{"_uuid":"d2f8e3b65e781fef4a5e80a4352d318482a790fe","_cell_guid":"639083b7-a61e-4716-95e1-e3f8b61b228e"},"cell_type":"markdown","source":"**Top 10 Food Items:**\n\nThe top 10 food items being produced since 1961 and in the last 5 years. Milk, cereals and vegetables remain the top three products to be produced. Share of Fruits production is more in the last 5 years. However, the share of Milk, cereals, wheat products, starchy roots and rice has dropped in the last 5 years and these are the most in demand food items for our daily sustainance."},{"metadata":{"_kg_hide-input":true,"_uuid":"c41a2c6ab4ccee7367742f65ff547a1ea36f07ca","_cell_guid":"f665bc36-665d-4870-8210-7ddfd09fb26d","trusted":true},"cell_type":"code","source":"p6 <- fao %>% group_by(item) %>%filter(element == 'Food')%>% \nsummarise(TFO = sum(Total)) %>% ungroup()%>%mutate(pct = prop.table(TFO)*100)%>%\n    top_n(10, wt = pct)%>%\n    ggplot(aes(x = reorder(item, pct), y = pct)) + \n   geom_bar(stat = 'identity', fill = \"lightyellow\", aes(color = I('black')), size = 0.1) + coord_flip()+\n    geom_text(aes(label = sprintf(\"%.2f%%\", pct)), hjust = 1.2,\n            vjust = -0.5, size = 3)+ theme_bw()+ xlab(\"Food Item\") + ylab(\"Food Item production since 1961\")\n\np7 <- fao %>% group_by(item) %>%filter(element == 'Food')%>% \nsummarise(TFO = sum(last5)) %>% ungroup()%>%mutate(pct = prop.table(TFO)*100)%>%\n    top_n(10, wt = pct)%>%\n    ggplot(aes(x = reorder(item, pct), y = pct)) + \n   geom_bar(stat = 'identity', fill = \"lightyellow\", aes(color = I('black')), size = 0.1) + coord_flip()+\n    geom_text(aes(label = sprintf(\"%.2f%%\", pct)), hjust = 1.2,\n            vjust = -0.5, size =3)+ theme_bw()+ xlab(\"Food Item\") + ylab(\"Food Item production since 2008-13\")\n\nplot_grid(p6,p7, align = \"h\")","execution_count":10,"outputs":[]},{"metadata":{"_uuid":"50e87854fb094ae310da785cd9c9d22ec22650d0","_cell_guid":"a4651ac1-269e-4b13-ad42-abe23c62772c"},"cell_type":"markdown","source":"**Top 10 Feed Items:**\n\nCereals, Maize and Starchy roots are produced more for feeding our animals."},{"metadata":{"_kg_hide-input":true,"_uuid":"bf3ec1af709b62202373e1811f2e02704b1f2c76","_cell_guid":"3e71642d-dba6-479b-88b7-de456f3d6280","trusted":true},"cell_type":"code","source":"p8 <- fao %>% group_by(item) %>%filter(element == 'Feed')%>% \nsummarise(TFO = sum(Total)) %>% ungroup()%>%mutate(pct = prop.table(TFO)*100)%>%\n    top_n(10, wt = pct)%>%\n    ggplot(aes(x = reorder(item, pct), y = pct)) + \n   geom_bar(stat = 'identity', fill = \"lightpink\", aes(color = I('black')), size = 0.1) + coord_flip()+\n    geom_text(aes(label = sprintf(\"%.2f%%\", pct)), hjust = 0.01,\n            vjust = -0.5, size = 3)+ theme_bw()+ xlab(\"Food Item\") + ylab(\"Feed Item production since 1961\")\n\np9 <- fao %>% group_by(item) %>%filter(element == 'Feed')%>% \nsummarise(TFO = sum(last5)) %>% ungroup()%>%mutate(pct = prop.table(TFO)*100)%>%\n    top_n(10, wt = pct)%>%\n    ggplot(aes(x = reorder(item, pct), y = pct)) + \n   geom_bar(stat = 'identity', fill = \"lightpink\", aes(color = I('black')), size = 0.1) + coord_flip()+\n    geom_text(aes(label = sprintf(\"%.2f%%\", pct)), hjust = 0.01,\n            vjust = -0.5, size =3)+ theme_bw()+ xlab(\"Food Item\") + ylab(\"Feed Item production since 2008-13\")\n\nplot_grid(p8,p9, align = \"h\")","execution_count":11,"outputs":[]},{"metadata":{"_uuid":"c9644caad564494e5bdf8434b0cff6184cf4ba1d","_cell_guid":"158f4bcb-b8ba-4209-a595-8000c67408fb"},"cell_type":"markdown","source":"**Comparison of Food & Feed Production:** \n\nThe next plot shows the food and feed production from 1961-2013. Although, there is a steady growth in Food production but the Feed production is not at all impresive over the years. Also, the gap between food and feed production is a lot. We can also see that there is a jump in both food and feed production from 1991-1992, this i am assuming is due to the addition of new countries during that year."},{"metadata":{"_uuid":"91e6c20b4a6e7c464d6b38459aca5c009580d87c","_cell_guid":"627d3ddc-0dff-4fbe-86ef-5e9012b71c72","trusted":true},"cell_type":"code","source":"fao1 <- fao %>% gather(11:63 ,key = \"year\", value = \"Total\")%>%\ngroup_by(year, element) %>% na.omit()%>%\nsummarise(TFO = sum(Total)) #%>% spread(key = element, value = TFO)\n\nggplot(fao1, aes(year, TFO)) + \n  geom_line(aes(group = element), colour = \"yellow\") + \n  geom_point(aes(colour = element))+ theme(axis.text.x = element_text(angle = 90, hjust = 1))+\n    xlab(\"Year\") + ylab(\"Total Production\")+ ggtitle(\"Comparison of Food & Feed Production\")","execution_count":12,"outputs":[]},{"metadata":{"_uuid":"1e1e4e7f40143f264dfed4a044ac00650b42e3c8","_cell_guid":"58c7094a-3d54-4a22-bdf3-7812d6999446"},"cell_type":"markdown","source":"**Feed production over the years:**\n\nAs we can see from the plot below, the production of only a few feed products such as cereals, maize, starchy roots, milk and barely show an increasing trend from 1961-2013. \n\n***Spiced latte for the livestock***\n\nAnother interesting thing to note is from the year 1991 onwards,  spices,cloves and cocoa beans are categorised as feed items(Really!!! I mean what would our livestocks have then \"spiced latte\" or something)"},{"metadata":{"_kg_hide-input":true,"_uuid":"b66e0527e682063bef05f2570bb7ec8e090d94dd","_cell_guid":"9736a5da-970a-4d66-adcc-b0e5031d6d38","trusted":true},"cell_type":"code","source":"options(repr.plot.width=10, repr.plot.height=12)\nfao3 <- fao %>% gather(11:63 ,key = \"year\", value = \"Total\")%>%\ngroup_by(year, item, element) %>% na.omit()%>%\nsummarise(Total_production = sum(Total))%>%filter(element == 'Feed')\nggplot(data = fao3) +\n  theme_bw() +\n  geom_tile(aes(x = year, y = item, fill = Total_production)) +\n  scale_fill_viridis(direction = -1) + theme(axis.text.x = element_text(angle = 90, hjust = 1), plot.title = element_text(hjust = 0.5), \n                                             panel.grid.major = element_blank(), panel.grid.minor = element_blank())+\n    xlab(\"Year\") + ylab(\"Feed Items\")+ ggtitle(\"Production of feed items over the years\")\n\n","execution_count":13,"outputs":[]},{"metadata":{"_uuid":"5e83fb9fd32f0e59786cfb8d3ba97a389de9a6b5","_cell_guid":"8b8acc1b-0972-49b9-8c1a-b2e3cc1aeaae"},"cell_type":"markdown","source":"**Food production over the years:**\n\n***Why so serious when we have cereals!!!***\n\nThe world is consuming more cereals, we can see that the production of cereals and milk together has increased over the time(makes sense, demand for cereal will increase the demand for milk, we do eat cereals with milk right!!)\n\n\n***Rice & Starchy roots are evergreen***\n\nQuite literally!!! The production of these items is almost stable over the years\n\n***Veggies are good & so is gluten***\n\nThe production of vegetables and wheat products have increased significantly"},{"metadata":{"_kg_hide-input":true,"_uuid":"63e7a58f43ac828d2eee58d52f8b6e42be64cb99","_cell_guid":"5c7f3b38-bfc1-4cee-a025-6cb98a4c47c5","trusted":true},"cell_type":"code","source":"options(repr.plot.width=10, repr.plot.height=12)\n\nfao2 <- fao %>% gather(11:63 ,key = \"year\", value = \"Total\")%>%\ngroup_by(year, item, element) %>% na.omit()%>%\nsummarise(Total_production = sum(Total))%>%filter(element == 'Food')\nggplot(data = fao2) +\n  theme_bw() +\n  geom_tile(aes(x = year, y = item, fill = Total_production)) +\n  scale_fill_viridis(direction = -1) + theme(axis.text.x = element_text(angle = 90, hjust = 1), plot.title = element_text(hjust = 0.5))+\n    xlab(\"Year\") + ylab(\"Food Items\")+ ggtitle(\"Production of food items over the years\")","execution_count":14,"outputs":[]},{"metadata":{"_uuid":"70c2a3ac7f636d52fcd99e51e1bb171f569d483b","_cell_guid":"0535376a-ee0b-4b2f-9345-8ec9419428e7"},"cell_type":"markdown","source":"**Country wise Time Series display of production:**\n\nFrom the interactive plot below, we can see the country wise production of food and feed from 1961 onwards. It is interesting to note that only China has a significant increase in food and feed froduction over the years, followed by India(which is 'ok' when compared to China). \n\nOn the other hand,  another top producer of food and feed in the World(USA), actually has more ups and downs, there is also a decline in production in USA from the year 2004 onwards.\n\nApart from these top 3 countries, no other country has a significant rise in production over so many years, and this is not impressive at all. Russia on the other hand started well in the year 1992 but it failed to pick up the production when compared to China, India and USA."},{"metadata":{"scrolled":true,"_kg_hide-input":true,"_uuid":"962494ccff2056afda501949c0f43c805bb86955","_cell_guid":"4a43e0d8-bec2-450e-a372-41db639ae625","trusted":true},"cell_type":"code","source":"options(repr.plot.width=10, repr.plot.height=12)\noptions(scipen = 99999)\nfao4 <- fao %>% gather(11:63 ,key = \"year\", value = \"Total\")%>%\ngroup_by(year, area_abb) %>% \nsummarise(TFO = sum(Total)) %>% spread(key = area_abb, value = TFO)\nfao4$year <- as.Date(gsub(\"Y\", \"\", fao4$year), format = '%Y')\n\ndf_ts <- as.xts(x = fao4[,-1], order.by = fao4$year)\nm <- dygraph(df_ts, main = \"Country wise Production Timeseries\") %>%\n dyHighlight(highlightSeriesOpts = list(strokeWidth = 3))%>%\n  dyLegend(show = \"follow\")#thanks to https://rstudio.github.io/dygraphs/gallery-series-highlighting.html for the tutorial on dygraphs\n\n#the below display hack is taken from https://gist.github.com/timelyportfolio/cf7b94048ffe7b6a0112\n\nm$x$css = \"\n.dygraph-legend > span {display:none;}\n.dygraph-legend > span.highlight { display: inline; }\n\"\n\nhtmlwidgets::saveWidget(m, \"m.html\")\ndisplay_html('<iframe src=\"m.html\" width=100% height=450></iframe>')","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"936b1352c2cb7893173054f9ee223c0791c60244","_cell_guid":"fd845d53-268c-4681-a043-a80f913cc1fc"},"cell_type":"markdown","source":"**Time series Modelling:**\n\nNow in this section, we would do some basic time series analysis of the fao dataset and see what has been happening over the years. Though the production shows an increasing trend from 1961 onwards, but do we know the underlying trend in the data? So, to find that out, we will begin with first separating the time series into it's different components. \nA time series has mainly three componentsGlobal, Locall and Noise. \n\n*Global Component: In general,  the total production of food and feed has been increasing over the years. Hence, if we fit a regression model on to it will get a straight line which gives the overall pattern of the data. So overall, we expect the production to go up every year. That's why this is called as the global pattern of the data. The global component has two parts trends and seasonality. \n*\n\n\n*Local Component: We also see lots of ups and downs in the data, on top of the simple regression fit. In a time series, we have to model this part of the data as well. This is called the local pattern in the time series because the values here don’t show any long-term pattern. The values don’t increase regularly or repeat with a set frequency, so there is no overall global pattern. However, locally, there is some predictability. The local component should have some stationarity in it otherwise it cannot be modelled.*\n\n*Noise: or the unpredictable part, is what remains when we extract the global and local pattern from the time series. It is a set of uncorrelated values, and if we plot it then we do not get any trend or seasonal pattern etc. *"},{"metadata":{"_uuid":"1e9eb690e143df3245a853ae646a0742aa9f2ec6","_cell_guid":"a63a2fd9-7830-40e4-a15f-fa566b269013","trusted":true},"cell_type":"code","source":"#Loading the required libraries\noptions(repr.plot.width=6, repr.plot.height=4)\nlibrary(graphics)\nlibrary(forecast)\nlibrary(tseries)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"15d60e73e424d39b27005df824cdd70704098697","_cell_guid":"54b7d261-6549-4b1a-a750-877a550dd34d"},"cell_type":"markdown","source":"First we will prepare the data for the timeseries analysis"},{"metadata":{"_uuid":"d957ced727873ff73e7dd6a83ada482a8d6ad1fa","_cell_guid":"7b9499bc-104f-4d95-a508-2dd7bad06d97","trusted":true},"cell_type":"code","source":"fao5 <- fao %>% gather(11:63 ,key = \"year\", value = \"Total\")%>%\ngroup_by(year) %>% na.omit()%>%\nsummarise(TP = sum(Total)) ","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"53be93c942d3e6b70d0ee3a1975160dc68aa9472","_cell_guid":"2653afac-872e-49bd-ab68-c33a8fc9bb4d"},"cell_type":"markdown","source":"Now, Convert dataframe to time series and visualise the time series. We need to recognise the trend and seasonal component in the timeseries (we don't have a seasonal component on the data, but we do have a upward trend)."},{"metadata":{"_uuid":"6a61933f2afd24fee25316d2eb6d673572a24890","_cell_guid":"a16d4c7a-f71b-4526-a133-6c3b062917d1","trusted":true},"cell_type":"code","source":"timeser <- ts(fao5$TP)\nplot(timeser)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"83f5ccf435b73941f864d1d524029edde41596b8","_cell_guid":"7fbe5d31-e86d-4820-beb2-e0f63f153f37"},"cell_type":"markdown","source":""},{"metadata":{"_uuid":"6e4e8f7a62e14becb2e767d45def544151f023d2","_cell_guid":"ec1e29e2-65fe-4ff3-b0f4-92d1d5f228c7"},"cell_type":"markdown","source":"Since, we have found an upward trend in the data, we will apply regression to model the trend and see the results. The plot below shows the global pattern of the data. "},{"metadata":{"_uuid":"c736dac55cfea0a7f41c9b46a05c9bedf91f4350","_cell_guid":"a5c5c5c4-0b3d-45f4-82c6-e830702bfe6b","trusted":true},"cell_type":"code","source":"timevals <- c(1961:2013)\ntimeserdf <- as.data.frame(cbind(timevals, as.vector(timeser)))\ncolnames(timeserdf) <- c('Year', 'Total_Production')\nlmfit <- lm(Total_Production ~ Year, data=timeserdf)\nglobalpred <- predict(lmfit, Year=timevals)\nplot(globalpred, col='red', type =\"l\" ,lwd=2)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"99bdc559f05f6c216f785a948765304db9a9a9a1","_cell_guid":"19a4aacc-219c-4e04-884f-144ab61b8b03"},"cell_type":"markdown","source":"Remember, we have to inspect the local pattern in the data as well. So now, let's inspect the local component of the time series, for that we need to separate the global prediction from the time series."},{"metadata":{"_uuid":"ef71946d8e6464f7ecfa3689f3206945a3c42ffe","_cell_guid":"6f92ca64-4ffa-4f09-a09b-f9f633bbc152","trusted":true},"cell_type":"code","source":"localpred <- timeser - globalpred\nplot(localpred, col='red', type = \"l\")","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"c568bbd6ba1b1c2c41b8f500327b6fdc00635ade","_cell_guid":"333b5c4f-ea13-4a36-b882-2e0b21f6af58"},"cell_type":"markdown","source":"The above graphs shows the local component of the time series, which is very different from the global pattern of the data. So, we have to model this part of the data as well like we did for the global part. But, for that we need to check the stationarity of the data, a local part needs to be stationary (mostly weak) in order to be modelled. Weak stationarity would imply that the values of the time series depend on past values in a fixed manner. So there is local predictability of some kind that is present. So, lets inspect the ACF of the local component, in order to understand if it has strong or weak stationarity. \n\nGenerally, the noise part of the data(the unpredictable part) has strong stationarity. So, it is very difficult to distinguish between noise and stationary data.  We will first look for the weak stationarity in the time series which is left after subtracting the global component. "},{"metadata":{"_uuid":"0d8e5180ad973caab0bc70bde62162a573755191","_cell_guid":"70ce4ee3-748d-44ec-847c-c0c2d796bbed","trusted":true},"cell_type":"code","source":"acf(localpred)\nacf(localpred, type=\"partial\")","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"63c0bb85db960b77269f80ef7102b9f36f57b30c","_cell_guid":"92a206ad-c9b5-4cf4-9876-ceed15126c77"},"cell_type":"markdown","source":"The Autocorrelation Function (ACF) of a noise component is zero(or within the blue lines in the ACF plot) for all non-zero lags. In other words, past values are not correlated with present values at all, making the series a sequence of independent, uncorrelated values. However, this is not the case in the ACF plot shown above, the ACF of all non-zero lags are well above the blue line, indicating that the local component does not have a strong stationarity. "},{"metadata":{"_uuid":"a6bcf8f6c50bc102b7adb7ddda68df5bfc431e06","_cell_guid":"918e0b9e-50e7-4856-80e7-d5de2f422987"},"cell_type":"markdown","source":"So now, let's make predictions for the local component of the time series using the auto.arima function, which returns the best ARIMA model according to either AIC, AICc or BIC value. "},{"metadata":{"_uuid":"b0c20217b1667eb47f607335dab364d0bcf4489f","_cell_guid":"223f0b82-9b8a-403a-97f2-5e7ba7c396ad","trusted":true},"cell_type":"code","source":"armafit <- auto.arima(localpred)\n#tsdiag(armafit)\narmafit","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"825a49c94b260f2cb3ce457dd79f0df47d609e98","_cell_guid":"6b92d670-2e8e-4981-85f1-29c8c3b22e80","trusted":true},"cell_type":"code","source":"armapred <- fitted(armafit)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"112b9f0abeb2f9fdb65e69108da19c6dd79c9de5","_cell_guid":"ea216581-6fa1-422f-87d9-fb660d3e1310"},"cell_type":"markdown","source":"Now, we are at a stage where we need to separate the noise component of the time series and check whether it is stationary or not(it should have strong stationarity and should not have any pattern, trend or seasonal components). To find the residual series we need to subtract the forecasted value of the local component from the actual observed value of the local component."},{"metadata":{"_uuid":"93b98ed9d9b685cf8d917b84fcaab850290aa4ba","_cell_guid":"7905ce60-be1f-4880-a4ab-4f2f166f2525","trusted":true},"cell_type":"code","source":"residual <- localpred - armapred\nplot(residual)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"4fb7ee853235685a1b7fc006f9531f6365c11b1a","_cell_guid":"18332cf6-71b6-481f-b58d-4ab682e186f7"},"cell_type":"markdown","source":"Now, we have to check if the residual series is pure white noise by running ADF and KPSS tests for stationarity."},{"metadata":{"_uuid":"62236d92b79a98d44b3926da0b40597a266c6b07","_cell_guid":"5f309688-44ec-4682-bd31-2369d21eb152","trusted":true},"cell_type":"code","source":"adf.test(residual,alternative = \"stationary\")\nkpss.test(residual)","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"5000dc0d4ed213eaa7a2ec137c2cc53102a05fe3","_cell_guid":"8d5ab2fe-8c9d-4d9a-a242-cccf4711415d"},"cell_type":"markdown","source":"In order to check the strong stationarity of the noise component, we have two tests and they are as follows, \n\n\nIn case ADF test, the Null hypothesis assumes that the series is not stationary. The p-value from the ADF test is 0.01, which is below the normal cutoff of 0.05. This means that we can reject the null hypothesis and can conclude that the series(noise or residual in this case) is stationary.\n\nWhere as, in KPSS test Null hypothesis assumes that the series is stationary. The p-value from the KPSS test is 0.1, which is above the cutoff of 0.05, meaning we have failed to reject the Null hypothesis, and can conlclude that the series is stationary.\n\nIn the above time series process we have successfully separated the global, local and noise components of the Food and Feed production time series. "},{"metadata":{"_uuid":"f5b789a416a2e9a56a9b0b6f55918937b11bcdb0","_cell_guid":"0f5bbdce-9c14-42ff-bb52-277c26435a37"},"cell_type":"markdown","source":"Thank you for visiting the Kernel."}],"metadata":{"kernelspec":{"display_name":"R","language":"R","name":"ir"},"language_info":{"mimetype":"text/x-r-source","name":"R","pygments_lexer":"r","version":"3.4.2","file_extension":".r","codemirror_mode":"r"}},"nbformat":4,"nbformat_minor":1}