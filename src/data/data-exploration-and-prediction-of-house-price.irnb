{"metadata": {"language_info": {"mimetype": "text/x-r-source", "file_extension": ".r", "name": "R", "codemirror_mode": "r", "pygments_lexer": "r", "version": "3.4.1"}, "kernelspec": {"language": "R", "name": "ir", "display_name": "R"}}, "cells": [{"metadata": {"_uuid": "39e4e18a80a9485df07fb3fb981541117a09700d", "_execution_state": "busy", "_cell_guid": "c1c3bd1f-ea9a-4b58-a21f-320109f87b39"}, "cell_type": "markdown", "source": ["<br>\n", "**<font face=\"calibri\" color=\"black\" size=\"6\">Prediction of Housing Price using R</font>**\n", "<br><br>\n", "**<font face=\"calibri\">July 2017</font>** <br> <br> <br> <br>\n", "**<font face=\"calibri\" color=\"blue\" size=\"5\">Part I Introduction</font>**\n", "<br><br>\n", "**<font face=\"calibri\">Goal</font>**\n", "<br><br><font face=\"calibri\" color=\"black\" size=\"4\">Predict the sale price of houses. </font>\n", "<br><br><br>\n", "**<font face=\"calibri\">Dataset Description</font>**\n", "<br><br><font face=\"calibri\" color=\"black\" size=\"4\">In this dataset, there are 1460 observations with 79 explanatory variables describing (almost) every aspect of residential homes in Ames, Iowa. Among explanatory variables, there are 37 integer variables, such as Id, MSSubClass, LotFrontage, and 43 factor variables, such as MSZoning, Street, LotShape. Descriptive analysis and quantitative analysis will use subsets of it depending on models.</font> \n", "<br><br>\n", "<img src=\"http://sturdyhome.com/wp-content/uploads/2013/09/House-images-2013-3.jpg\n", "\">\n"]}, {"metadata": {"_uuid": "ec187b22e7f289ca7756f22935f2198b46dc27e3", "_cell_guid": "83d86e95-b4db-46d2-a8b6-ebeb7ed45945"}, "cell_type": "markdown", "source": ["**<font face=\"calibri\" color=\"blue\" size=\"5\">Part II  Data Assessment</font>**"]}, {"metadata": {"_uuid": "652592f804ac0f86980d78eec7197b27fcafe242", "_cell_guid": "cbcdcdcc-3c56-469c-a997-bf03e622ea31"}, "cell_type": "markdown", "source": ["**<font face=\"calibri\" color=\"blue\" size=\"4\">2.1 Import Data</font>**"]}, {"metadata": {"_uuid": "06ca89d10d1e70ba561711f053dbab15e63606dc", "_execution_state": "idle", "_cell_guid": "c2b7d551-d157-4f6b-8bab-e995386f0b2a"}, "source": ["library(ggplot2) # Data visualization\n", "library(readr) # CSV file I/O, e.g. the read_csv function\n", "library(gplots)\n", "library(repr)\n", "\n", "# Change plot size to 5 x 4\n", "options(repr.plot.width=5, repr.plot.height=4)\n", "\n", "list.files(\"../input\")"], "outputs": [], "cell_type": "code", "execution_count": 2}, {"metadata": {"_uuid": "a9a22841c86398b2f8dbd6db59133d1a94f73ed8", "collapsed": true, "_cell_guid": "257c1083-fa7c-460f-bfc7-58b7b5563a9b"}, "source": ["train <- read.csv(\"../input/train.csv\")"], "outputs": [], "cell_type": "code", "execution_count": 3}, {"metadata": {"_uuid": "9d9dc6484d8c1137ce654d1e1ed4ef560428969e", "_cell_guid": "e49c1f0f-f04e-4fff-a78c-f8dc9792204e"}, "cell_type": "markdown", "source": ["**<font face=\"calibri\" color=\"blue\" size=\"4\">2.2 Check Missing Data</font>**"]}, {"metadata": {"_uuid": "2205a480d3fc91c0492352dd9364bc28f09ba410", "_cell_guid": "b2ee6d42-b3ed-46c7-b981-bc34fd915c08"}, "cell_type": "markdown", "source": ["<font face=\"calibri\" color=\"black\" size=\"4\">We find that every row in this dataset has missing value, and we will deal with it later. </font>"]}, {"metadata": {"_uuid": "e4672e7b755a572b3b14706b5c6474eabdae8e6a", "_execution_state": "idle", "_cell_guid": "ed2ae0b8-31dc-41ee-a98c-58cfdfe30fb4"}, "source": ["# list rows of data that have missing values \n", "missing_row <- train[!complete.cases(train),]\n", "head(missing_row)"], "outputs": [], "cell_type": "code", "execution_count": 4}, {"metadata": {"_uuid": "dd025c9e31e0a3275f99001eebde6a928690b09f", "_execution_state": "idle", "_cell_guid": "edc4844c-f315-49be-ae9c-9dc43b42ccfd"}, "source": ["nrow(missing_row)"], "outputs": [], "cell_type": "code", "execution_count": 5}, {"metadata": {"_uuid": "31e735b50c74a2c02b6c3fb62f19c0c684f808c5", "_cell_guid": "fd91b63b-61d9-4176-b7f7-d97a8185e597"}, "cell_type": "markdown", "source": ["**<font face=\"calibri\" color=\"blue\" size=\"4\">2.3 Select Variables</font>**\n", "<br><br><font face=\"calibri\" color=\"black\" size=\"4\">Select variables that may have greater impact on house price and construct subset of train dataset that is used for prediction. Here, we select these important variables by creating a vector that contains variable names. </font>"]}, {"metadata": {"_uuid": "75ea3213cc40b2eb80934e1145a1b75aec79c40d", "_cell_guid": "cb54bbef-3cc8-49d4-ae93-17ca66160493"}, "source": ["var_name <- names(train)\n", "var_name"], "outputs": [], "cell_type": "code", "execution_count": 6}, {"metadata": {"_uuid": "bb565fe65ad4106231efb321c2959874da9c0f2c", "collapsed": true, "_execution_state": "idle", "_cell_guid": "5a025087-b999-4b97-a1f7-04c93d2f220f"}, "source": ["select_var <- c('Id','MSZoning','Utilities', 'Neighborhood','BldgType','HouseStyle',\n", "                'OverallQual','OverallCond','YearBuilt', 'ExterQual','ExterCond',\n", "                'BsmtQual','BsmtCond','TotalBsmtSF','Heating','HeatingQC', \n", "                'CentralAir','Electrical','GrLivArea','BedroomAbvGr','KitchenAbvGr',\n", "                'KitchenQual','TotRmsAbvGrd','Functional','Fireplaces','FireplaceQu',\n", "               'GarageArea','GarageQual','GarageCond','OpenPorchSF','PoolArea',\n", "                'Fence','MoSold','YrSold','SaleType','SaleCondition','SalePrice') "], "outputs": [], "cell_type": "code", "execution_count": 7}, {"metadata": {"_uuid": "bd69a5185e210b3e823dc92c5495823ee2564dde", "_execution_state": "idle", "_cell_guid": "6489337f-d610-4604-b14e-7165efa8684f", "scrolled": true}, "source": ["# construct subset of train dataset that is used for prediction\n", "select_train <- train[,select_var]\n", "head(select_train)"], "outputs": [], "cell_type": "code", "execution_count": 8}, {"metadata": {"_uuid": "7ddc89de81fc7780429c59daa23c1c6d095b5489", "_execution_state": "idle", "_cell_guid": "221ec7c2-7d39-4bb7-ac2b-84f15c517aa4", "scrolled": true}, "source": ["summary(select_train)"], "outputs": [], "cell_type": "code", "execution_count": 9}, {"metadata": {"_uuid": "e169bdf05b8eb4f31591490561911861a78c826e", "_execution_state": "idle", "_cell_guid": "68ccad76-6cf4-4614-b79b-feb88a0e6c35"}, "cell_type": "markdown", "source": ["**<font face=\"calibri\" color=\"blue\" size=\"4\">2.4 Descriptive and exploratory analysis of SalePrice</font>**\n"]}, {"metadata": {"_uuid": "e664e73a12758349ddcf1fc5fcbd69024b0a266b", "_cell_guid": "9c2ba386-7b69-45f2-a5db-e2d531769ab1"}, "cell_type": "markdown", "source": ["**<font face=\"calibri\" color=\"blue\" size=\"4\">2.4.1 Summary of Target Variable: SalePrice</font>**"]}, {"metadata": {"_uuid": "3b1dca16b7ef9766ad4b6d37b96184b365b05c01", "_cell_guid": "384c4d26-2098-4332-81fe-b1203da592b9", "scrolled": true}, "source": ["# Five number summary\n", "summary(select_train$SalePrice)"], "outputs": [], "cell_type": "code", "execution_count": 10}, {"metadata": {"_uuid": "cf034200760a9aa2d3fc7f73ea306cf1c9a65ac7", "_cell_guid": "8d564d0b-e2bd-471d-8e7b-b27fa0f1ea8a"}, "source": ["# Draw a higtogram to figure out the distribution of SalePrice\n", "options(scipen=10000)\n", "ggplot(select_train, aes(x = SalePrice, fill = ..count..)) +\n", "  geom_histogram(binwidth = 5000) +\n", "  ggtitle(\"Figure 1 Histogram of SalePrice\") +\n", "  ylab(\"Count of houses\") +\n", "  xlab(\"Housing rice\") + \n", "  theme(plot.title = element_text(hjust = 0.5))"], "outputs": [], "cell_type": "code", "execution_count": 11}, {"metadata": {"_uuid": "787b17c6146e6f8f7461df847e28c763ba779d45", "_cell_guid": "0e62aa9c-2152-474b-930c-5929e8fb1f11"}, "cell_type": "markdown", "source": ["<font face=\"calibri\" size=\"4\">From the histogram above, the distribution of our target variable-- SalePrice is skewed to right.  Thus, a log term of SalePrice should be generated for linear regression. Here, we name it lSalePrice.  </font>"]}, {"metadata": {"_uuid": "ccfb1f5218a3aa7b40b1c62a26c3f7d3673fef19", "collapsed": true, "_cell_guid": "23ecc9f5-41bb-4547-9a9c-4735ae5a1ea7"}, "source": ["#log term of SalePrice\n", "select_train$lSalePrice <- log(select_train$SalePrice)"], "outputs": [], "cell_type": "code", "execution_count": 12}, {"metadata": {"_uuid": "0d8b8f4602a545ec54a82dd23b3996cc11b2fd79", "_cell_guid": "01310e49-ddf1-4f35-a826-9998cd1e05a3"}, "cell_type": "markdown", "source": ["**<font face=\"calibri\" color=\"blue\" size=\"4\">2.4.2 Explore the distribution of SalePrice by MSZoning</font>**\n"]}, {"metadata": {"_uuid": "f05acc3eace6762a6fae39363eb3a72fc9bf7887", "_cell_guid": "19e901de-998a-4ee7-8d01-e68397af7d93"}, "cell_type": "markdown", "source": ["<font face=\"calibri\" size=\"4\">MSZoning: Identifies the general zoning classification of the sale.</font>\n", "\t\t\n", "       A\tAgriculture\n", "       C\tCommercial\n", "       FV\tFloating Village Residential\n", "       I\t Industrial\n", "       RH\tResidential High Density\n", "       RL\tResidential Low Density\n", "       RP\tResidential Low Density Park \n", "       RM\tResidential Medium Density"]}, {"metadata": {"_uuid": "20f04acfdb9a9af34089e293765a46e0567f673c", "_execution_state": "idle", "_cell_guid": "3543ac8c-9821-4cd6-90ea-be1fc8ab8848"}, "source": ["# Distribution of MSZoning\n", "ggplot(select_train, aes(x = MSZoning, fill = MSZoning )) + \n", "geom_bar()+ \n", "scale_fill_hue(c = 80)+\n", "ggtitle(\"Figure 2 Distribution of MSZoning\")+\n", "theme(plot.title = element_text(hjust = 0.5))+\n", "geom_text(stat='count',aes(label=..count..),vjust=-0.25)"], "outputs": [], "cell_type": "code", "execution_count": 13}, {"metadata": {"_uuid": "aacc542a1c23aabdff568d51438bb9bbe5bc4ff8", "_cell_guid": "a8b7ccb3-d038-46be-aa1b-c99216e7a452"}, "cell_type": "markdown", "source": ["<font face=\"calibri\" size=\"4\">Most of houses in this dataset are built within the area of \"Residential Low Density\", and then Residential Medium Density. </font>"]}, {"metadata": {"_uuid": "cfce53574a1778872c1e9be5acb2e719f4f91340", "_execution_state": "idle", "_cell_guid": "f23266e2-35ac-404c-b622-fcc3bee79aa0"}, "source": ["# Distribution of MSZoning\n", "table(select_train$MSZoning)"], "outputs": [], "cell_type": "code", "execution_count": 14}, {"metadata": {"_uuid": "1dd97a30ba7ce5e9056822da63e97c1c041f7ba3", "_execution_state": "idle", "_cell_guid": "282e4d7d-be5b-4226-9a52-bdc5fc819c69"}, "source": ["ggplot(select_train, aes(x=MSZoning, y=SalePrice, fill=MSZoning)) + \n", "    geom_boxplot(alpha=0.3) +\n", "    theme(legend.position=\"none\")+\n", "    ggtitle(\"Figure 3 Boxplot of SalePrice by MSZoning\")+\n", "    theme(plot.title = element_text(hjust = 0.5))"], "outputs": [], "cell_type": "code", "execution_count": 15}, {"metadata": {"_uuid": "8b436606f0ef7d0b8eb4bdb365b2caca2df02e58", "_execution_state": "idle", "_cell_guid": "ded45663-395f-474b-8faf-961e8bd75b21"}, "cell_type": "markdown", "source": ["<font face=\"calibri\" size=\"4\">The graph above shows the distribution of SalePrice by MSZoning. The sales within \"Floating Village Residential\" have the highest average sale price, and followed by \"Residential Low Density\". While \"Commercial\" sales have the lowest average sale price. </font>"]}, {"metadata": {"_uuid": "62f00437f7b6b7a8d426a8f885626c1aff05c370", "_cell_guid": "eb037dee-c4ff-4424-b6f7-92cd19ee49dc"}, "cell_type": "markdown", "source": ["**<font face=\"calibri\" color=\"blue\" size=\"4\">2.4.3 Explore the distribution of SalePrice by BldfType</font>**"]}, {"metadata": {"_uuid": "e887570ecfff1d486e67a41aa7930c07db3217a4", "_cell_guid": "7a9309dc-b323-40db-8cd7-78b304f03105"}, "source": ["# historgram of housing price by BldgType \n", "ggplot(select_train, aes(SalePrice)) +\n", " geom_histogram(aes(fill = BldgType), position = position_stack(reverse = TRUE), binwidth = 20000) +\n", " coord_flip() + ggtitle(\"Figure 4 Histogram of SalePrice\") +\n", " ylab(\"Housing Price\") +\n", " xlab(\"Count\") + \n", " theme(plot.title = element_text(hjust = 0.5))"], "outputs": [], "cell_type": "code", "execution_count": 16}, {"metadata": {"_uuid": "755aabb91f0c6a9f79b6332ca3a7a5b099c9f832", "_cell_guid": "efe8983a-fb53-4e0c-b573-a18dcc4ab925"}, "cell_type": "markdown", "source": ["**<font face=\"calibri\" color=\"blue\" size=\"4\">2.5 Explore the Correlation for SalePrice</font>**"]}, {"metadata": {"_uuid": "a4d3e1a83ebc09f227b9367d7820b8eccd46a856", "_cell_guid": "a90dac80-236e-4e96-9486-d52a5e6cca9c"}, "cell_type": "markdown", "source": ["**<font face=\"calibri\" color=\"blue\" size=\"4\">2.5.1 Build Heatmap of correlation for SalePrice</font>**"]}, {"metadata": {"_uuid": "c0dfbc6e9afc0378d1ff88c795b38bf435d7412e", "_cell_guid": "17c77aea-edef-4c71-b8fc-2e73e9d939a2"}, "cell_type": "markdown", "source": ["<font face=\"calibri\" size=\"4\">Feature Engineering for select variables. Some variables are factors, in order to buid heatmap we need to convert them into numerics. Since these varaibles evaluate qualities with ordered levels :  \"Ex\", \"Fa\",\"Gd\", \"TA\",\"Po\", we match them to values: \"5\",\"4\",\"3\",\"2\",\"1\".  </font>"]}, {"metadata": {"_uuid": "484fbfe1e9cc6d240b0e1987e5eba7bbd0c69762", "collapsed": true, "_execution_state": "idle", "_cell_guid": "c740086a-654a-4a1c-be01-c91c1266cbd6"}, "source": ["# convert factor to numeric\n", "select_train$ExterQual2 <- as.numeric(factor(select_train$ExterQual, \n", "                                  levels = c(\"Ex\", \"Fa\",\"Gd\", \"TA\"),\n", "                                  labels = c(5,2,4,3) ,ordered = TRUE))\n", "\n", "select_train$ExterCond2 <- as.numeric(factor(select_train$ExterCond, \n", "                                  levels = c(\"Ex\", \"Fa\",\"Gd\", \"TA\",\"Po\"),\n", "                                  labels = c(5,2,4,3,1) ,ordered = TRUE))\n", "\n", "select_train$BsmtQual2 <- as.numeric(factor(select_train$BsmtQual, \n", "                                  levels = c(\"Ex\", \"Fa\",\"Gd\", \"TA\"),\n", "                                  labels = c(5,2,4,3) ,ordered = TRUE))\n", "\n", "select_train$BsmtCond2 <- as.numeric(factor(select_train$BsmtCond, \n", "                                 levels = c(\"Fa\", \"Gd\",\"Po\", \"TA\"),\n", "                                 labels = c(2,4,1,3) ,ordered = TRUE))\n", "\n", "select_train$HeatingQC2 <- as.numeric(factor(select_train$HeatingQC, \n", "                                  levels = c(\"Ex\", \"Fa\",\"Gd\", \"TA\",\"Po\"),\n", "                                  labels = c(5,2,4,3,1) ,ordered = TRUE))\n", "select_train$CentralAir2 <- as.numeric(factor(select_train$CentralAir, \n", "                                  levels = c(\"N\", \"Y\"),\n", "                                  labels = c(0,1) ,ordered = TRUE))"], "outputs": [], "cell_type": "code", "execution_count": 17}, {"metadata": {"_uuid": "20345d04e4568c744b32d452b806db219babf77b", "collapsed": true, "_execution_state": "idle", "_cell_guid": "87184b5e-9c5e-4ba4-bd9c-b1f21211324d"}, "source": ["#select variables that be used to draw heatmap\n", "heat_var <- c('SalePrice', \n", "                'OverallQual','OverallCond','YearBuilt', 'ExterQual2','ExterCond2',\n", "                'TotalBsmtSF','HeatingQC2', \n", "                'CentralAir2','GrLivArea','BedroomAbvGr','KitchenAbvGr',\n", "                'TotRmsAbvGrd','Fireplaces',\n", "                'GarageArea','OpenPorchSF','PoolArea',\n", "                 'YrSold')\n", "heat <- select_train[,heat_var]"], "outputs": [], "cell_type": "code", "execution_count": 18}, {"metadata": {"_uuid": "693dc941a1dad4d4797d538d75b0881df0f1c53c", "_execution_state": "idle", "_cell_guid": "c67451ae-d70e-4391-96fa-4b0cb49ec58d"}, "source": ["options(repr.plot.width=8, repr.plot.height=6)\n", "library(ggplot2)\n", "library(reshape2)\n", "qplot(x=Var1, y=Var2, data=melt(cor(heat, use=\"p\")), fill=value, geom=\"tile\") +\n", "   scale_fill_gradient2(low = \"green\", high = \"red\", mid = \"white\", \n", "   midpoint = 0, limit = c(-1,1), space = \"Lab\", \n", "   name=\"Correlation\") +\n", "   theme_minimal()+ \n", "   theme(axis.text.x = element_text(angle = 45, vjust = 1, size = 8, hjust = 1))+\n", "   coord_fixed()+\n", "   ggtitle(\"Figure 5 Correlation Heatmap\") +\n", "   theme(plot.title = element_text(hjust = 0.4))"], "outputs": [], "cell_type": "code", "execution_count": 22}, {"metadata": {"_uuid": "73fbec09be20b3eb3167a790f23705a19249e481", "_cell_guid": "399b26c9-9d3d-4a93-9f21-e8d8529c3279"}, "cell_type": "markdown", "source": ["**<font face=\"calibri\" color=\"blue\" size=\"5\">Part III  Model Fitting</font>**"]}, {"metadata": {}, "cell_type": "markdown", "source": []}], "nbformat_minor": 1, "nbformat": 4}